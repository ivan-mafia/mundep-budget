---
# Feel free to add content and custom Front Matter to this file.
# To modify the layout, see https://jekyllrb.com/docs/themes/#overriding-theme-defaults

layout: home
---
<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {

        var data = google.visualization.arrayToDataTable([
          ['Программа', 'тыс. руб.', 'key'],
{% for program in site.data.mo7.2021.program.programs %}
          ['{{ program.key }}: {{ program.name }}',     {{ program.sum }}, '{{ program.key }}'],
{% endfor %}
        ]);

        var options = {
          title: 'Бюджет МО7'
        };

        var subProgramDict = {};
{% for program in site.data.mo7.2021.program.programs %}
        subProgramDict['{{program.key}}'] = [
            ['{{ program.key }}: {{ program.name }}', 'тыс. руб.', 'key'],
  {% for subprogram in program.subprograms %}
            ['{{ subprogram.key }}: {{ subprogram.name }}', {{subprogram.sum}} ,'{{ subprogram.key }}'],
  {% endfor %}
        ];
{% endfor %}

{% for program in site.data.mo7.2021.program.programs %}
  {% for subprogram in program.subprograms %}
          subProgramDict['{{subprogram.key}}'] = [
              ['{{ subprogram.key }}: {{ subprogram.name }}', 'тыс. руб.', 'key'],
    {% for subsubprogram in subprogram.subprograms %}
              ['{{ subsubprogram.key }}: {{ subsubprogram.name }}', {{subsubprogram.sum}} ,'{{ subsubprogram.key }}'],
    {% endfor %}
          ];
  {% endfor %}
{% endfor %}


        var chart = new google.visualization.PieChart(document.getElementById('piechart'));
        var subChart = new google.visualization.PieChart(document.getElementById('programInformirovanie'));
        var subSubChart = new google.visualization.PieChart(document.getElementById('subprogramInformirovanie'));

        var subData = []

        function selectHandler() {
          var selectedItem = chart.getSelection()[0];
          if (selectedItem) {
            var program = data.getValue(selectedItem.row, 0);
            var key = data.getValue(selectedItem.row, 2);
            var subOptions = {
              title: program
            };
            subData = google.visualization.arrayToDataTable(subProgramDict[key]);
            subChart.draw(subData, subOptions);
          }
        }

        function subSelectHandler() {
          var selectedItem = subChart.getSelection()[0];
          if (selectedItem) {
            var program = subData.getValue(selectedItem.row, 0);
            var key = subData.getValue(selectedItem.row, 2);
            var subOptions = {
              title: program
            };
            var subSubData = google.visualization.arrayToDataTable(subProgramDict[key]);
            subSubChart.draw(subSubData, subOptions);
          }
        }

        google.visualization.events.addListener(chart, 'select', selectHandler);
        google.visualization.events.addListener(subChart, 'select', subSelectHandler);       
        chart.draw(data, options);
      }
    </script>
  </head>
  <body>
    2021 year
    <div id="piechart" style="width: 900px; height: 500px;"></div>
    <div id="programInformirovanie" style="width: 900px; height: 500px;"></div>
    <div id="subprogramInformirovanie" style="width: 900px; height: 500px;"></div>
  </body>
</html>
